<div id="authModal" class="auth-modal" aria-hidden="true" style="display: none;">
    <div class="auth-modal-backdrop" onclick="closeAuthModal()"></div>
    <div class="auth-modal-panel">
        <button class="modal-close" onclick="closeAuthModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
        
        <div class="auth-tabs">
            <button class="auth-tab-btn active" onclick="showAuthTab('login')">Login</button>
            <button class="auth-tab-btn" onclick="showAuthTab('register')">Register</button>
        </div>

        <div id="loginTab" class="auth-tab-content active">
            <h3>Login to LaboConnect</h3>
            <p class="muted">Access your business dashboard or admin panel.</p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" placeholder="email@example.com" required>

                <label for="login-password">Password:</label>
                <input type="password" id="login-password" placeholder="********" required>
                
                <div id="login-error" class="auth-error"></div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Log In</button>
                <p class="muted small" style="text-align: center; margin-top: 15px;">Don't have an account? <a href="#" onclick="showAuthTab('register'); return false;">Register here.</a></p>
            </form>
        </div>
        
        <div id="registerTab" class="auth-tab-content">
            <h3>Register Your Account</h3>
            <p class="muted">Sign up as a Business Owner to manage your listings or as an Admin to access the BPLO panel.</p>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <label for="reg-name">Full Name:</label>
                <input type="text" id="reg-name" placeholder="Juan Dela Cruz" required>
                
                <label for="reg-email">Email:</label>
                <input type="email" id="reg-email" placeholder="email@example.com" required>

                <label for="reg-password">Password:</label>
                <input type="password" id="reg-password" placeholder="Minimum 6 characters" required minlength="6">
                
                <label for="reg-role">Account Type:</label>
                <select id="reg-role" required>
                    <option value="business">Business Owner (Standard User)</option>
                    <option value="admin">BPLO Admin</option>
                </select>

                <div id="reg-token-wrap" style="display:none; margin-top:8px;">
                    <label for="reg-admin-token">Admin Token:</label>
                    <input type="text" id="reg-admin-token" placeholder="Enter admin token" />
                    <div class="muted small" style="margin-top:6px;">You must provide a valid admin token generated by an existing admin.</div>
                </div>

                <div id="register-error" class="auth-error"></div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Register</button>
            </form>
        </div>
    </div>
</div>

<style>
.auth-modal {
    display: none; position: fixed; inset: 0; z-index: 1500; align-items: center; justify-content: center; padding: 20px;
}
.auth-modal.open { display: flex; }
.auth-modal-backdrop { position: absolute; inset: 0; background: rgba(8,12,10,0.7); }
.auth-modal-panel { 
    position: relative; width: 100%; max-width: 420px; background: var(--card, #ffffff); border-radius: 12px; 
    box-shadow: 0 10px 40px rgba(2,6,23,0.6); padding: 30px;
}
.auth-modal-panel h3 { margin-top: 0; font-size: 20px; }
.auth-modal-panel p.muted { font-size: 14px; }
.auth-modal-panel label { display: block; margin-top: 10px; font-weight: 600; font-size: 14px; color: var(--dark, #0f172a); }
.auth-modal-panel input[type="email"], .auth-modal-panel input[type="password"], .auth-modal-panel input[type="text"], .auth-modal-panel select {
    width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #e5e7eb; border-radius: 8px; box-sizing: border-box;
}
.auth-modal .modal-close { 
    position: absolute; top: 15px; right: 15px; background: none; border: none; cursor: pointer; color: var(--muted, #6b7280); 
    padding: 5px; border-radius: 50%; 
}
.auth-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; }
.auth-tab-btn { 
    padding: 10px 15px; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--muted, #6b7280);
    border-bottom: 2px solid transparent; margin-bottom: -1px; transition: border-color 0.2s;
}
.auth-tab-btn.active { color: var(--accent, #2d8f5a); border-color: var(--accent, #2d8f5a); }
.auth-tab-content { display: none; }
.auth-tab-content.active { display: block; }
.auth-error { color: #ef4444; font-size: 13px; margin-top: 8px; font-weight: 600; }
</style>

<script>
    function showAuthTab(tabId) {
        document.querySelectorAll('.auth-tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.auth-tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId + 'Tab').classList.add('active');
        document.querySelector(`.auth-tab-btn[onclick*="${tabId}"]`).classList.add('active');
        
        // Clear errors when switching tabs
        document.getElementById('login-error').textContent = '';
        document.getElementById('register-error').textContent = '';
    }

    // Since handleLogin and handleRegister are defined in global.js, we don't define them here.
    // We only need the tab helper.
    (function setupRegisterRoleHandler(){
        const roleSel = document.getElementById('reg-role');
        const tokenWrap = document.getElementById('reg-token-wrap');
        function update() {
            if (!roleSel || !tokenWrap) return;
            if (roleSel.value === 'admin') {
                tokenWrap.style.display = '';
                const tok = document.getElementById('reg-admin-token'); if (tok) tok.setAttribute('required', 'required');
            } else {
                tokenWrap.style.display = 'none';
                const tok = document.getElementById('reg-admin-token'); if (tok) tok.removeAttribute('required');
            }
        }
        if (roleSel) {
            roleSel.addEventListener('change', update);
            // run immediately in case the modal was injected after DOMContentLoaded
            setTimeout(update, 30);
        }
    })();
</script>